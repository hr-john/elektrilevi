<!DOCTYPE html>
<html lang="et-EE">
<head>
 <TITLE>
   Sobiva Elektrilevi paketi leidmine
 </TITLE>
<style>
body {
  background-image: url("https://hr-john.github.io/elektrilevi/Windmill.jpeg") ;
  background-size: cover;
}
 P { margin:0; text-indent: 2em }
</style>
 <script src="chartist.js">
 </script>
 <script>
 function display(msg) {
   var p = document.createElement('p');
    p.innerHTML = String(msg);
    document.body.appendChild(p);
   }
 
function showFile(input) {
  let file = input.files[0];
  alert(`File name: ${file.name}`); // e.g my.png
  alert(`Last modified: ${file.lastModified}`); // e.g 1552830408824
}
 
function readFile(input) {
  let file = input.files[0];
  let reader = new FileReader();
  reader.readAsText(file);
  reader.onload = function() {
    display(reader.result);
    alert(`File name: ${file.name}`);
    console.log(reader.result);
  };


  reader.onerror = function() {
    console.log(reader.error);
  };
}
     function kuva() {
      var xhr = new XMLHttpRequest();
      xhr.onreadystatechange = handleStateChange;
      xhr.open("GET", "https://dashboard.elering.ee/api/nps/price/csv?start=2021-04-11T21:00:00.000Z&end=2021-04-12T20:59:59.999Z&fields=ee");
      xhr.send();   //      display("Request sent");
      
      function handleStateChange() {
        if (xhr.readyState == 4 &&
            xhr.status >= 200 &&
            xhr.status < 300) {  //          display("Got response");
          showData(xhr.responseText);
         // return xhr.responseText ;
        }
    var rows = csvToArray(xhr.responseText); 
     var data = {
  // A labels array that can contain any sort of values
  labels: ['00', '01', '02', '03', '04'],
  // Our series array that contains series objects or in this case series data arrays
  series: [
    rows
  ]
};

// Create a new line chart object where as first parameter we pass in a selector
// that is resolving to our chart container element. The Second parameter
// is the actual data object.
new Chartist.Line('.ct-chart', data);
       
      }

      
function csvToArray(text) {
    let p = '', row = [''], ret = [row], i = 0, r = 0, s = !0, l;
    for (l of text) {
        if ('"' === l) {
            if (s && l === p) row[i] += l;
            s = !s;
        } else if (',' === l && s) l = row[++i] = '';
        else if ('\n' === l && s) {
            if ('\r' === p) row[i] = row[i].slice(0, -1);
            row = ret[++r] = [l = '']; i = 0;
        } else row[i] += l;
        p = l;
    }
    return ret;
};

      function showData(data) {
//        var rows = data.split(/\s+/);       var rows = data.split("\n");
        var rows = csvToArray(data);
        var rowNum;
        var cells;   //        var cellNum;
        for (rowNum = 0; rowNum < rows.length; ++rowNum) {
         cells = rows[rowNum][0].split(";") ;        //         display("row " + rowNum +                  " has " + cells.length + " values(s)");
         display(rowNum + " : " + cells[1] + " -    " + cells[2]);
        }
      }

    }
  
  
  
    new Chartist.Bar('.ct-chart-bar', {
      labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
      series: [
        [5, 4, 3, 7, 5, 10, 3]
      ]
    }, {
      axisX: {
        // On the x-axis start means top and end means bottom
        position: 'start'
      },
      axisY: {
        // On the y-axis start means left and end means right
        position: 'end'
      }
    });
</script>
</head>

 <body>
  <H1>TERE READING</H1>
  <input type="file" onchange="readFile(this)"> 
  <button id="download" type="button" onclick="kuva()" name="button">CSV</button>
  <div class="ct-chart ct-perfect-fourth"></div>
  <div class="ct-chart-line ct-perfect-fourth"></div>
  <div class="ct-chart-bar ct-perfect-fourth"></div>
 </body>
</html>
