<!DOCTYPE html>
<html lang="et-EE">
<head>
 <TITLE>
   Koolis√µidu protokoll
 </TITLE>
<style>
body {
  background-image: url("https://hr-john.github.io/elektrilevi/horse.jpg") ;
  background-size: cover;
}
</style>
<script>
  function display(msg) {
   var p = document.createElement('p');
    p.innerHTML = String(msg);
    document.body.appendChild(p);
   }
 
 function loe(){
  var container = document.getElementById("SKEEM"),
    cTable = document.createElement("table");
    cTable.id = "SKEEM";
    container.innerHTML = "";
    container.appendChild(cTable);

  var cRow = document.createElement("tr"),
        cCell = null,
        headline = ["Nr", "", "Harjutus", "Hinne", "K", "Kokku", "Direktiivid","Kommentaarid"];
    for (var d of headline) {
      cCell = document.createElement("td");
      cCell.innerHTML = d;
      cRow.appendChild(cCell);
    }
    cRow.classList.add("head");
    cTable.appendChild(cRow);
  
  var skeemif = new XMLHttpRequest();
   skeemif.onreadystatechange = handleStateChange;
   skeemif.open('GET', 'https://hr-john.github.io/elektrilevi/hobu/st1.txt');
   skeemif.send();
  
    function handleStateChange() {
        if (skeemif.readyState == 4 &&
            skeemif.status >= 200 &&
            skeemif.status < 300) {
          insertTable(skeemif.responseText);
        }
      } // handleStateChange
  
 
 
 function csvToArray(text) {
    let p = '', row = [''], ret = [row], i = 0, r = 0, s = !0, l;
    for (l of text) {
        if ('"' === l) {
            if (s && l === p) row[i] += l;
            s = !s;
        } else if (',' === l && s) l = row[++i] = '';
        else if ('\n' === l && s) {
            if ('\r' === p) row[i] = row[i].slice(0, -1);
            row = ret[++r] = [l = '']; i = 0;
        } else row[i] += l;
        p = l;
    } //for l to text
   return ret;
 }; // csvToArray

 function insertTable(data) {
//        var rows = data.split(/\s+/);       var rows = data.split("\n");
       var nr=[],mark=[],harjutus=[],koefitsent=[],direktiiv=[] ;
        var rows = csvToArray(data);
        var rowNum,reanr=1,ridu=0;
        var cells;   //        var cellNum;
         for (rowNum = 0; rowNum < rows.length-1; ++rowNum) {
          cells = rows[rowNum][0].split(";") ;       
          nr.push(cells[0]);mark.push(cells[1]);harjutus.push(cells[2]);koefitsent.push(cells[3]);direktiiv.push(cells[4]);
           if ( reanr === nr[nr.length-1] ) { ridu++ }
           else { ridu=0 ; reanr = cells[0]; }
          }// for rowNum
          var total = rowNum;
          alert("NR " + nr[0] + " "+rowNum + " " + ridu);

          cRow = document.createElement("tr");
          cRow.classList.add("sisu");
           for (var i=0; i<total; i++) {
    //        cCell = document.createElement("td");
            cRow.innerHTML = "<TD>"+nr[i]+"</TD><TD>"+mark[i]+"</TD><TD>"+harjutus[i]+"</TD><TD>"+"HINNE"+"</TD><TD>"+koefitsent[i]+"</TD><TD>"+"LOPPHINNE"+"</TD><TD>"+direktiiv[i]+"</TD><TD>"+"KOMMENTAAR"+"</TD>" ;
//            cCell.addEventListener("click", function(){
//             alert(this.getElementsByClassName("dd")[0].innerHTML);
//            });
//                  cRow.appendChild(cCell);
    cTable.appendChild(cRow);

           } // for i to total
      cTable.appendChild(cRow);

         
  //          display(rowNum + " : " + cells[1] + " -    " + cells[2]);
      }; // insertTable

  
 }; // loe
 
</script>
</head>

 <body>
  <H1>TERE READING</H1>
 <button type="button" onclick="loe()">LOE ST1</button>
   <div id="SKEEM"></div>
 </body>
</html>
